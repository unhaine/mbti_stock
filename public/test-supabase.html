<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supabase ì—°ê²° í…ŒìŠ¤íŠ¸</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    button {
      background: #4CAF50;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    button:hover {
      background: #45a049;
    }
    #result {
      margin-top: 20px;
      padding: 15px;
      background: #f9f9f9;
      border-left: 4px solid #4CAF50;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 12px;
      max-height: 500px;
      overflow-y: auto;
    }
    .error {
      border-left-color: #f44336;
      background: #ffebee;
    }
    .loading {
      color: #666;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” Supabase ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
    <p>ì´ í˜ì´ì§€ëŠ” Supabaseì—ì„œ ë°ì´í„°ë¥¼ ì§ì ‘ ê°€ì ¸ì™€ì„œ í‘œì‹œí•©ë‹ˆë‹¤.</p>
    
    <button onclick="testSupabase()">Supabase JS í´ë¼ì´ì–¸íŠ¸ í…ŒìŠ¤íŠ¸</button>
    <button onclick="testRestAPI()">REST API ì§ì ‘ í…ŒìŠ¤íŠ¸</button>
    <button onclick="clearResult()">ê²°ê³¼ ì§€ìš°ê¸°</button>
    
    <div id="result"></div>
  </div>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'
    
    const supabaseUrl = 'https://pwkhgxefvkwwvpmsurgt.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB3a2hneGVmdmt3d3ZwbXN1cmd0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg1MjU0MTIsImV4cCI6MjA4NDEwMTQxMn0.jz6oRQ9YuM6uW_7pO6i-4aF7j-pGIObf3Rjv22S3AYw'
    
    const supabase = createClient(supabaseUrl, supabaseKey)
    
    window.testSupabase = async function() {
      const resultDiv = document.getElementById('result')
      resultDiv.className = 'loading'
      resultDiv.textContent = 'â³ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...\n'
      
      try {
        console.log('ğŸš€ Supabase í…ŒìŠ¤íŠ¸ ì‹œì‘...')
        
        // 1. ì‚¼ì„±ì „ìë§Œ ê°€ì ¸ì˜¤ê¸°
        resultDiv.textContent += '\nğŸ“¥ ì‚¼ì„±ì „ì ë°ì´í„° ì¡°íšŒ ì¤‘...\n'
        const { data: samsung, error: samsungError } = await supabase
          .from('stocks')
          .select('*')
          .eq('ticker', '005930')
          .single()
        
        if (samsungError) {
          throw new Error(`ì‚¼ì„±ì „ì ì¡°íšŒ ì‹¤íŒ¨: ${samsungError.message}`)
        }
        
        resultDiv.textContent += '\nâœ… ì‚¼ì„±ì „ì ë°ì´í„°:\n'
        resultDiv.textContent += JSON.stringify(samsung, null, 2)
        resultDiv.textContent += '\n\nğŸ“Š ì£¼ìš” ì •ë³´:\n'
        resultDiv.textContent += `  - ì´ë¦„: ${samsung.name}\n`
        resultDiv.textContent += `  - í‹°ì»¤: ${samsung.ticker}\n`
        resultDiv.textContent += `  - ê¸°ë³¸ ê°€ê²©: ${samsung.price}ì›\n`
        resultDiv.textContent += `  - ì‹¤ì‹œê°„ ê°€ê²©: ${samsung.livePrice}ì›\n`
        resultDiv.textContent += `  - ì‹¤ì‹œê°„ ë°ì´í„° ì—¬ë¶€: ${samsung.isLiveData}\n`
        resultDiv.textContent += `  - í‘œì‹œë  ê°€ê²©: ${samsung.livePrice || samsung.price}ì›\n`
        
        // 2. ì „ì²´ ì¢…ëª© ê°œìˆ˜ í™•ì¸
        resultDiv.textContent += '\n\nğŸ“¥ ì „ì²´ ì¢…ëª© ê°œìˆ˜ ì¡°íšŒ ì¤‘...\n'
        const { count, error: countError } = await supabase
          .from('stocks')
          .select('*', { count: 'exact', head: true })
        
        if (countError) {
          throw new Error(`ì¢…ëª© ê°œìˆ˜ ì¡°íšŒ ì‹¤íŒ¨: ${countError.message}`)
        }
        
        resultDiv.textContent += `âœ… ì „ì²´ ì¢…ëª© ê°œìˆ˜: ${count}ê°œ\n`
        
        // 3. ì‹¤ì‹œê°„ ë°ì´í„°ê°€ ìˆëŠ” ì¢…ëª© ê°œìˆ˜
        const { data: liveStocks, error: liveError } = await supabase
          .from('stocks')
          .select('ticker, name, livePrice, isLiveData')
          .eq('isLiveData', true)
        
        if (liveError) {
          throw new Error(`ì‹¤ì‹œê°„ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨: ${liveError.message}`)
        }
        
        resultDiv.textContent += `âœ… ì‹¤ì‹œê°„ ë°ì´í„° ì¢…ëª©: ${liveStocks.length}ê°œ\n`
        
        resultDiv.className = ''
        console.log('âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ!')
        
      } catch (error) {
        resultDiv.className = 'error'
        resultDiv.textContent += `\n\nâŒ ì—ëŸ¬ ë°œìƒ:\n${error.message}\n\n`
        resultDiv.textContent += `Stack:\n${error.stack}`
        console.error('âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error)
      }
    }
    
    window.testRestAPI = async function() {
      const resultDiv = document.getElementById('result')
      resultDiv.className = 'loading'
      resultDiv.textContent = 'â³ REST APIë¡œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...\n'
      
      try {
        console.log('ğŸš€ REST API í…ŒìŠ¤íŠ¸ ì‹œì‘...')
        
        const supabaseUrl = 'https://pwkhgxefvkwwvpmsurgt.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB3a2hneGVmdmt3d3ZwbXN1cmd0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg1MjU0MTIsImV4cCI6MjA4NDEwMTQxMn0.jz6oRQ9YuM6uW_7pO6i-4aF7j-pGIObf3Rjv22S3AYw'
        
        // 1. ì‚¼ì„±ì „ì ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        resultDiv.textContent += '\nğŸ“¥ ì‚¼ì„±ì „ì ë°ì´í„° ì¡°íšŒ ì¤‘ (REST API)...\n'
        
        const response = await fetch(`${supabaseUrl}/rest/v1/stocks?ticker=eq.005930`, {
          headers: {
            'apikey': supabaseKey,
            'Authorization': `Bearer ${supabaseKey}`,
            'Content-Type': 'application/json',
            'Prefer': 'return=representation'
          }
        })
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`)
        }
        
        const data = await response.json()
        
        if (!data || data.length === 0) {
          throw new Error('ì‚¼ì„±ì „ì ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤')
        }
        
        const samsung = data[0]
        
        resultDiv.textContent += '\nâœ… ì‚¼ì„±ì „ì ë°ì´í„° (REST API):\n'
        resultDiv.textContent += JSON.stringify(samsung, null, 2)
        resultDiv.textContent += '\n\nğŸ“Š ì£¼ìš” ì •ë³´:\n'
        resultDiv.textContent += `  - ì´ë¦„: ${samsung.name}\n`
        resultDiv.textContent += `  - í‹°ì»¤: ${samsung.ticker}\n`
        resultDiv.textContent += `  - ê¸°ë³¸ ê°€ê²©: ${samsung.price}ì›\n`
        resultDiv.textContent += `  - ì‹¤ì‹œê°„ ê°€ê²©: ${samsung.livePrice}ì›\n`
        resultDiv.textContent += `  - ì‹¤ì‹œê°„ ë°ì´í„° ì—¬ë¶€: ${samsung.isLiveData}\n`
        resultDiv.textContent += `  - í‘œì‹œë  ê°€ê²©: ${samsung.livePrice || samsung.price}ì›\n`
        
        // 2. ì „ì²´ ì¢…ëª© ê°œìˆ˜
        resultDiv.textContent += '\n\nğŸ“¥ ì „ì²´ ì¢…ëª© ê°œìˆ˜ ì¡°íšŒ ì¤‘...\n'
        
        const countResponse = await fetch(`${supabaseUrl}/rest/v1/stocks?select=count`, {
          headers: {
            'apikey': supabaseKey,
            'Authorization': `Bearer ${supabaseKey}`,
            'Prefer': 'count=exact'
          }
        })
        
        const countHeader = countResponse.headers.get('content-range')
        const count = countHeader ? countHeader.split('/')[1] : 'unknown'
        
        resultDiv.textContent += `âœ… ì „ì²´ ì¢…ëª© ê°œìˆ˜: ${count}ê°œ\n`
        
        resultDiv.className = ''
        console.log('âœ… REST API í…ŒìŠ¤íŠ¸ ì™„ë£Œ!')
        
      } catch (error) {
        resultDiv.className = 'error'
        resultDiv.textContent += `\n\nâŒ ì—ëŸ¬ ë°œìƒ:\n${error.message}\n\n`
        resultDiv.textContent += `Stack:\n${error.stack}`
        console.error('âŒ REST API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error)
      }
    }
    
    window.clearResult = function() {
      document.getElementById('result').textContent = ''
      document.getElementById('result').className = ''
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
    window.addEventListener('load', () => {
      console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ. í…ŒìŠ¤íŠ¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.')
    })
  </script>
</body>
</html>
